<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couple Voice Chat Room</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div class="app-container">
        
        <header class="room-header">
            <h3>тЭдя╕П Love Caf├й (Room #101)</h3>
            <span class="live-badge">LIVE ЁЯФ┤</span>
        </header>

        <div class="host-area">
            <div class="seat host-seat" id="host-seat">
                <img src="https://i.pravatar.cc/150?img=1" alt="Host" class="avatar">
                <div class="mic-icon active">ЁЯОд</div>
                <span class="username">Host Annie ЁЯСС</span>
            </div>
        </div>

        <div class="seats-grid" id="seats-grid">
            <div class="seat empty-seat"><span>+</span></div> 
        </div>

        <div class="footer-controls">
            <button class="btn" onclick="sendChatMessage()">ЁЯТм Chat</button>
            <button class="btn gift-btn" onclick="simulateGift(500)">ЁЯОБ Gift (500)</button>
            <button class="btn">ЁЯЪк Leave</button>
        </div>

        <div id="notification-area"></div>
        
        <div id="gift-animation-container"></div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script> 
    <script src="scripts/socketClient.js"></script>
    <script src="scripts/ui.js"></script> 
    
    <script>
        // 1. рдпреВрдЬрд╝рд░ ID рдЬреЗрдирд░реЗрдЯ рдХрд░реЗрдВ (рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЬрд╝рд░реВрд░реА)
        let currentUserId = localStorage.getItem('userId');
        if (!currentUserId) {
            currentUserId = 'User_' + Math.random().toString(36).substring(2, 9);
            localStorage.setItem('userId', currentUserId);
            console.log('New User ID generated:', currentUserId);
        } else {
            console.log('Existing User ID:', currentUserId);
        }
        
        // Socket.io рдХрдиреЗрдХреНрд╢рди рд▓реЙрдЬрд┐рдХ (рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ io() рдХреЙрд▓ рд╣реЛ)
        const socket = io(); 
        
        // 2. рдХрдиреЗрдХреНрд╢рди рдкрд░, рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдкрдиреА ID рдмрддрд╛рдПрдБ рдФрд░ рд░реВрдо рдЬреЙрдЗрди рдХрд░реЗрдВ
        socket.on('connect', () => {
            const roomId = '101'; 
            console.log('Attempting to join room 101 with ID:', currentUserId);
            // рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓рд╛рдЗрди рд╣реИ рдЬреЛ рд╕рд░реНрд╡рд░ рдХреЛ ID рднреЗрдЬрддреА рд╣реИ!
            socket.emit('join_room', { roomId, userId: currentUserId }); 
        });

        // 3. GIFT рдмрдЯрди рдХрд╛ рд▓реЙрдЬрд┐рдХ
        window.simulateGift = function(amount) {
            console.log(`Attempting to send ${amount} gift as user: ${currentUserId}`);

            // Gift API Call - рд╕рд░реНрд╡рд░ рдХреЛ рдпреВрдЬрд╝рд░ ID (X-User-ID) рднреЗрдЬ рд░рд╣рд╛ рд╣реИ
            fetch('/api/wallet/gift', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // рдЗрд╕ рд╣реЗрдбрд░ рд╕реЗ рд╕рд░реНрд╡рд░ рдХреЛ рдкрддрд╛ рдЪрд▓реЗрдЧрд╛ рдХрд┐ рдЧрд┐рдлреНрдЯ рдХреМрди рднреЗрдЬ рд░рд╣рд╛ рд╣реИ
                    'X-User-ID': currentUserId 
                },
                body: JSON.stringify({
                    senderId: currentUserId,
                    receiverId: 'HostAnnie', // рд╣реЛрд╕реНрдЯ рдХреЛ рд░рд┐рд╕реАрд╡рд░ рдорд╛рди рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
                    amount: amount
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Gifting Successful! Wallet Updated.');
                    // рдпрд╣рд╛рдВ Socket.io рд╕реЗ рдПрдирд┐рдореЗрд╢рди рдпрд╛ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рднреЗрдЬрдиреЗ рдХрд╛ рдХреЛрдб рдЖрдПрдЧрд╛
                    // рдЙрджрд╛рд╣рд░рдг: socket.emit('gift_sent', { sender: currentUserId, receiver: 'HostAnnie', amount: amount });
                } else {
                    // рдпрджрд┐ рд╕рд░реНрд╡рд░ рдиреЗ рдХреЛрдИ рдореИрд╕реЗрдЬ рджрд┐рдпрд╛ рддреЛ рд╡рд╣ рджрд┐рдЦрд╛рдПрдЧрд╛, рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдПрд░рд░ рдЕрдм рдирд╣реАрдВ рдЖрдиреА рдЪрд╛рд╣рд┐рдП
                    alert('Gifting Failed: ' + (data.message || 'Check server logs.'));
                }
            })
            .catch(error => console.error('Fetch Error:', error));
        };
        
        // 4. Chat рд▓реЙрдЬрд┐рдХ (рдорд╛рди рд▓реЗрдВ рдХрд┐ chatClient.js рдореЗрдВ рдХреЛрдИ рдлрдВрдХреНрд╢рди рд╣реИ)
        window.sendChatMessage = function() {
            const message = prompt("Enter your chat message:");
            if (message) {
                 // Socket.io рд╕реЗ рдЪреИрдЯ рдЗрд╡реЗрдВрдЯ рднреЗрдЬреЗрдВ
                socket.emit('chat_message', { userId: currentUserId, message: message });
            }
        };
        
        // рдЪреИрдЯ рдмрдЯрди рдХреЛ рднреА рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
        // <button class="btn" onclick="sendChatMessage()">ЁЯТм Chat</button>

    </script>
    </body>
</html>
